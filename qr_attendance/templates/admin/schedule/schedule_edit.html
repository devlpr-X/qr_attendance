{% extends "base.html" %}
{% block title %}–•—É–≤–∞–∞—Ä—å - {{ semester.school_year }} {{ semester.term }}{% endblock %}

{% block content %}

<style>
  .schedule-header { 
    background: linear-gradient(135deg, #667eea 0%, #5977f9 100%);
    color: white; padding: 2rem; border-radius: 8px; margin-bottom: 2rem;
  }
  .schedule-header h2 { margin: 0 0 0.5rem 0; }
  .schedule-header p { margin: 0.3rem 0; opacity: 0.9; }
  
  .section { 
    background: white; padding: 2rem; border-radius: 8px; 
    box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 2rem;
  }
  .section h3 { margin-top: 0; color: #1d5ede; border-bottom: 2px solid #1d5ede; 
                padding-bottom: 0.5rem; }
  
  .table-wrapper { overflow-x: auto; margin-bottom: 1rem; }
  table { width: 100%; border-collapse: collapse; }
  th { background: #f5f5f5; font-weight: 600; }
  th, td { padding: 0.8rem; text-align: left; border: 1px solid #ddd; }
  tr:hover { background: #f9f9f9; }
  
  .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
              gap: 1rem; margin-bottom: 1rem; }
  .form-group { display: flex; flex-direction: column; }
  .form-group label { margin-bottom: 0.4rem; font-weight: 600; color: #333; }
  .form-group input, .form-group select { 
    padding: 0.6rem; border: 1px solid #ddd; border-radius: 4px; 
  }
  .form-group input:focus, .form-group select:focus { 
    outline: none; border-color: #1d5ede; box-shadow: 0 0 0 3px rgba(29, 94, 222, 0.1);
  }
  
  .btn-group { display: flex; gap: 0.5rem; flex-wrap: wrap; }
  button { padding: 0.6rem 1.2rem; border: none; border-radius: 4px; 
           cursor: pointer; font-weight: 600; }
  .btn-primary { background: #1d5ede; color: white; }
  .btn-primary:hover { background: #154fb5; }
  .btn-danger { background: #d32f2f; color: white; }
  .btn-danger:hover { background: #b71c1c; }
  .btn-success { background: #2e7d32; color: white; }
  .btn-success:hover { background: #1b5e20; }
  
  .empty-state { text-align: center; padding: 2rem; color: #999; }
</style>

<div class="schedule-header">
  <h2>üìñ {{ semester.school_year }} –æ–Ω—ã {{ semester.term }}-—Ä —Å–µ–º–µ—Å—Ç—Ä–∏–π–Ω —Ö—É–≤–∞–∞—Ä—å</h2>
  <p>üè´ –°—É—Ä–≥—É—É–ª—å: {{ semester.school_id }}</p>
  <p>üìÖ {{ semester.start_date }} - {{ semester.end_date }}</p>
</div>

<!-- 1. –ù–≠–ú–≠–ì–î–°–≠–ù –•–£–í–ê–ê–†–¨ -->
<div class="section">
  <h3>üìã –ù—ç–º—ç–≥–¥—Å—ç–Ω —Ö–∏—á—ç—ç–ª–∏–π–Ω —Ö—É–≤–∞–∞—Ä—å</h3>
  
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>–•–∏—á—ç—ç–ª</th>
          <th>–ë–∞–≥—à</th>
          <th>”®–¥”©—Ä</th>
          <th>–¶–∞–≥</th>
          <th>–¢”©—Ä”©–ª</th>
          <th>–î–∞–≤—Ç–∞–º–∂</th>
          <th>–ë–∞–π—Ä—à–∏–ª</th>
          <th>“Æ–π–ª–¥—ç–ª</th>
        </tr>
      </thead>
      <tbody>
        {% for p in patterns %}
        <tr>
          <td><strong>{{ p.course }}</strong><br><small style="color: #999;">{{ p.course_code }}</small></td>
          <td>{{ p.teacher }}</td>
          <td>{{ p.day }}</td>
          <td>{{ p.timeslot }}</td>
          <td>{{ p.lesson_type }}</td>
          <td><small>{{ p.frequency_text }}</small></td>
          <td>{{ p.location }}</td>
          <td>
            <form method="POST" style="display: inline;">
              {% csrf_token %}
              <input type="hidden" name="action" value="delete_pattern">
              <input type="hidden" name="pattern_id" value="{{ p.id }}">
              <button type="submit" class="btn-danger" onclick="return confirm('–≠–Ω—ç —Ö–∏—á—ç—ç–ª–∏–π–Ω —Ö—É–≤–∞–∞—Ä–∏–π–≥ —É—Å—Ç–≥–∞—Ö —É—É?')">üóëÔ∏è</button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="8" class="empty-state">–•–∏—á—ç—ç–ª–∏–π–Ω —Ö—É–≤–∞–∞—Ä—å –±–∞–π—Ö–≥“Ø–π</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- 2. –®–ò–ù–≠ –•–£–í–ê–ê–†–¨ –ù–≠–ú–≠–• -->
<div class="section">
  <h3>‚ûï –®–∏–Ω—ç —Ö–∏—á—ç—ç–ª–∏–π–Ω —Ö—É–≤–∞–∞—Ä—å –Ω—ç–º—ç—Ö</h3>
  
  <form method="POST">
    {% csrf_token %}
    <input type="hidden" name="action" value="add_pattern">
    
    <div class="form-row">
      <div class="form-group">
        <label>–•–∏—á—ç—ç–ª:</label>
        <select name="course_id" required>
          <option value="">–°–æ–Ω–≥–æ–Ω–æ —É—É</option>
          {% for c in courses %}
          <option value="{{ c.0 }}">{{ c.1 }} ({{ c.2 }})</option>
          {% endfor %}
        </select>
      </div>
      
      <div class="form-group">
        <label>–ë–∞–≥—à:</label>
        <select name="teacher_id" required>
          <option value="">–°–æ–Ω–≥–æ–Ω–æ —É—É</option>
          {% for t in teachers %}
          <option value="{{ t.0 }}">{{ t.1 }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>”®–¥”©—Ä:</label>
        <select name="day_of_week" required>
          <option value="">–°–æ–Ω–≥–æ–Ω–æ —É—É</option>
          <option value="0">–î–∞–≤–∞–∞</option>
          <option value="1">–ú—è–≥–º–∞—Ä</option>
          <option value="2">–õ—Ö–∞–≥–≤–∞</option>
          <option value="3">–ü“Ø—Ä—ç–≤</option>
          <option value="4">–ë–∞–∞—Å–∞–Ω</option>
          <option value="5">–ë—è–º–±–∞</option>
          <option value="6">–ù—è–º</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>–¶–∞–≥:</label>
        <select name="timeslot" required>
          <option value="">–°–æ–Ω–≥–æ–Ω–æ —É—É</option>
          {% for slot in timeslots %}
          <option value="{{ slot.slot }}">{{ slot.name }} ({{ slot.slot }})</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>–•–∏—á—ç—ç–ª–∏–π–Ω —Ç”©—Ä”©–ª:</label>
        <select name="lesson_type" required>
          <option value="">–°–æ–Ω–≥–æ—Ö...</option>
          {% for lt in lesson_types %}
          <option value="{{ lt.1 }}">{{ lt.0 }} ({{ lt.1 }})</option>
          {% endfor %}
        </select>
      </div>
      
      <div class="form-group">
        <label>–ë–∞–π—Ä—à–∏–ª:</label>
        <select name="location_id">
          <option value="">–ó–∞–∞–≥–∞–∞–≥“Ø–π</option>
          {% for l in locations %}
          <option value="{{ l.0 }}">{{ l.1 }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>–î–∞–≤—Ç–∞–º–∂:</label>
        <select name="frequency" required>
          <option value="1">–î–æ–ª–æ–æ —Ö–æ–Ω–æ–≥ –±“Ø—Ä</option>
          <option value="2">2 –¥–æ–ª–æ–æ —Ö–æ–Ω–æ–≥ —Ç—É—Ç–∞–º</option>
          <option value="3">3 –¥–æ–ª–æ–æ —Ö–æ–Ω–æ–≥ —Ç—É—Ç–∞–º</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>–≠—Ö–ª—ç—Ö –æ–≥–Ω–æ–æ:</label>
        <input type="date" name="start_from_date" value="{{ semester.start_date }}">
      </div>
    </div>

    <button type="submit" class="btn-primary">‚ûï –•–∏—á—ç—ç–ª –Ω—ç–º—ç—Ö</button>
  </form>
</div>

<!-- 3. QR SESSION GENERATION -->
<div class="section" style="background: #e3f2fd; border-left: 4px solid #2196f3;">
  <h3>üéØ QR –°–µ—Å—Å“Ø“Ø–¥ “Ø“Ø—Å–≥—ç—Ö</h3>
  <p style="color:#666;">–•—É–≤–∞–∞—Ä—å –¥—ç—ç—Ä “Ø–Ω–¥—ç—Å–ª—ç–Ω –∞–≤—Ç–æ–º–∞—Ç QR —Å–µ—Å—Å“Ø“Ø–¥–∏–π–≥ “Ø“Ø—Å–≥—ç–Ω—ç.</p>
  
  <form method="POST" style="display:inline;">
    {% csrf_token %}
    <input type="hidden" name="action" value="generate_sessions">
    <button type="submit" class="btn-success" onclick="return confirm('–°–µ—Å—Å“Ø“Ø–¥–∏–π–≥ “Ø“Ø—Å–≥—ç—Ö “Ø“Ø?')">
      üöÄ “Æ“Ø—Å–≥—ç—Ö
    </button>
  </form>
</div>

{% endblock %}
