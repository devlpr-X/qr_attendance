{% extends "base.html" %}
{% block title %}–°—É—Ä–≥—É—É–ª–∏–π–Ω —Ü–∞–≥–∏–π–Ω —Ö—É–≤–∞–∞—Ä—å{% endblock %}

{% block content %}
<style>
  .timeslot-form { max-width: 1000px; margin: 0 auto; }
  .input-row { display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap; }
  .input-row input, .input-row button { 
    flex: 1; min-width: 150px; padding: 0.6rem; 
    border: 1px solid #ddd; border-radius: 4px; font-size: 0.95rem;
  }
  .input-row button { 
    background: #1d5ede; color: white; border: none; cursor: pointer; font-weight: 600;
  }
  .input-row button:hover { background: #154fb5; }
  
  .table-wrapper { overflow-x: auto; margin-bottom: 1.5rem; }
  table { width: 100%; border-collapse: collapse; }
  th, td { padding: 0.8rem; text-align: left; border: 1px solid #ddd; }
  th { background: #f5f5f5; font-weight: 600; }
  tr:hover { background: #f9f9f9; }
  .btn-delete { background: #d32f2f; color: white; padding: 0.4rem 0.8rem; 
                border: none; border-radius: 3px; cursor: pointer; font-size: 0.9rem; }
  .btn-delete:hover { background: #b71c1c; }
  
  .success-msg { padding: 0.8rem; background: #e8f5e9; color: #2e7d32; 
                 border-radius: 4px; margin-bottom: 1rem; border-left: 4px solid #4caf50; }
  .error-msg { padding: 0.8rem; background: #ffebee; color: #c62828; 
               border-radius: 4px; margin-bottom: 1rem; border-left: 4px solid #f44336; }
</style>

<div class="timeslot-form">
  <h2>üïê –°—É—Ä–≥—É—É–ª–∏–π–Ω —Ü–∞–≥–∏–π–Ω —Ö—É–≤–∞–∞—Ä—å</h2>
  <p style="color: #666; margin-bottom: 1.5rem;">–°—É—Ä–≥—É—É–ª–∏–π–Ω —É—Ä—Å–∞–∂ –±—É–π —Ü–∞–≥—É—É–¥—ã–≥ —Ç–æ—Ö–∏—Ä—É—É–ª–Ω–∞</p>

  {% if error %}
    <div class="error-msg">‚ö†Ô∏è {{ error }}</div>
  {% endif %}

  <form method="POST" id="timeslotsForm">
    {% csrf_token %}
    <input type="hidden" name="action" value="save_timeslots">
    <input type="hidden" name="timeslots_json" id="timeslots_json" value="">

    <div style="background: white; padding: 1.5rem; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
      <h3 style="margin-top: 0;">–¶–∞–≥–∏–π–Ω —Å–ª–æ—Ç –Ω—ç–º—ç—Ö</h3>
      
      <div class="input-row">
        <input type="time" id="slot_start" placeholder="–≠—Ö–ª—ç—Ö —Ü–∞–≥" required>
        <input type="time" id="slot_end" placeholder="–¢”©–≥—Å”©—Ö —Ü–∞–≥" required>
        <input type="text" id="slot_name" placeholder="–ù—ç—Ä (–∂–∏—à—ç—ç: 1-—Ä —Ü–∞–≥)" required>
        <button type="button" id="addSlotBtn">‚ûï –ù—ç–º—ç—Ö</button>
      </div>

      <div class="table-wrapper">
        <table id="slotsTable">
          <thead>
            <tr>
              <th style="width: 20%;">–≠—Ö–ª—ç–ª - –¢”©–≥—Å”©–ª</th>
              <th style="width: 60%;">–ù—ç—Ä</th>
              <th style="width: 20%; text-align: center;">“Æ–π–ª–¥—ç–ª</th>
            </tr>
          </thead>
          <tbody id="slotsTableBody">
            <tr><td colspan="3" style="text-align: center; color: #999;">–°–ª–æ—Ç –Ω—ç–º—ç—Ö–∏–π–Ω –¥–∞—Ä–∞–∞ —Ö–∞—Ä–∞–≥–¥–∞—Ö –±–æ–ª–Ω–æ</td></tr>
          </tbody>
        </table>
      </div>

      <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem;">
        <button type="submit" style="background: #2e7d32; color: white; padding: 0.8rem 1.5rem; 
                 border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">
          üíæ –•–∞–¥–≥–∞–ª–∞—Ö
        </button>
        <a href="{% url 'admin_dashboard' %}" style="text-decoration: none;">
          <button type="button" style="background: #757575; color: white; padding: 0.8rem 1.5rem; 
                   border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">
            ‚Üê –ë—É—Ü–∞—Ö
          </button>
        </a>
      </div>
    </div>
  </form>
</div>

<script>
let timeslots = [];

function renderSlots() {
  const tbody = document.getElementById('slotsTableBody');
  if (timeslots.length === 0) {
    tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #999;">–°–ª–æ—Ç –Ω—ç–º—ç—Ö–∏–π–Ω –¥–∞—Ä–∞–∞ —Ö–∞—Ä–∞–≥–¥–∞—Ö –±–æ–ª–Ω–æ</td></tr>';
    return;
  }
  
  tbody.innerHTML = timeslots.map((slot, idx) => `
    <tr>
      <td>${slot.slot}</td>
      <td><strong>${slot.name}</strong></td>
      <td style="text-align: center;">
        <button type="button" class="btn-delete" onclick="removeSlot(${idx})">üóëÔ∏è –£—Å—Ç–≥–∞—Ö</button>
      </td>
    </tr>
  `).join('');
}

function removeSlot(idx) {
  if (confirm('–≠–Ω—ç —Å–ª–æ—Ç—ã–≥ —É—Å—Ç–≥–∞—Ö–¥–∞–∞ —Å–∞–π–Ω —É—É?')) {
    timeslots.splice(idx, 1);
    renderSlots();
  }
}

document.getElementById('addSlotBtn').addEventListener('click', () => {
  const start = document.getElementById('slot_start').value;
  const end = document.getElementById('slot_end').value;
  const name = document.getElementById('slot_name').value;
  
  if (!start || !end || !name) {
    alert('–ë“Ø—Ö —Ç–∞–ª–±–∞—Ä—ã–≥ –±”©–≥–ª”©–Ω”© “Ø“Ø');
    return;
  }
  
  if (start >= end) {
    alert('–≠—Ö–ª—ç—Ö —Ü–∞–≥ —Ç”©–≥—Å”©—Ö —Ü–∞–≥–∞–∞—Å ”©–º–Ω”© –±–∞–π—Ö —ë—Å—Ç–æ–π');
    return;
  }
  
  // –î—É–±–ª–∏–∫–∞—Ç–∞ —à–∞–ª–≥–∞—Ö
  if (timeslots.some(s => s.slot === `${start}-${end}`)) {
    alert('–≠–Ω—ç —Ü–∞–≥–∏–π–Ω —Ö—É–≤–∞–∞—Ä—å –∞–ª—å —Ö—ç–¥–∏–π–Ω –±–∞–π–Ω–∞');
    return;
  }
  
  timeslots.push({ slot: `${start}-${end}`, name });
  document.getElementById('slot_start').value = '';
  document.getElementById('slot_end').value = '';
  document.getElementById('slot_name').value = '';
  renderSlots();
});

document.getElementById('timeslotsForm').addEventListener('submit', (e) => {
  if (timeslots.length === 0) {
    e.preventDefault();
    alert('–î–æ—Ä —Ö–∞—è–∂ –Ω—ç–≥ —Å–ª–æ—Ç –Ω—ç–º—ç—ç—Ä—ç–π');
    return;
  }
  document.getElementById('timeslots_json').value = JSON.stringify(timeslots);
});

renderSlots();
</script>
{% endblock %}