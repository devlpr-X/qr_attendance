{% extends "base.html" %}
{% block title %}Ирцийн төрөл{% endblock %}
{% block content %}

<h2>Ирцийн төрөл бүртгэл</h2>

{% if error %}
  <div style="color:#b00020;">{{ error }}</div>
{% endif %}

<!-- ADD FORM -->
<form method="POST" style="margin-bottom:1rem;">
    {% csrf_token %}
    <input type="hidden" name="action" value="add">

    <div style="display:flex; gap:0.6rem;">
        <input name="name" placeholder="Нэр (Ж: Ирсэн)" style="padding:0.5rem; width:240px;">
        <input name="value" placeholder="Утга (Ж: и)" style="padding:0.5rem; width:80px;">
        <button type="submit">Нэмэх</button>
    </div>
</form>

<hr>

<h3>Бүртгэлтэй төрлүүд</h3>

<table style="width:100%; border-collapse:collapse; margin-top:0.6rem;">
    <thead style="background:#f5f5f5;">
        <tr>
            <th style="padding:0.6rem;">№</th>
            <th style="padding:0.6rem;">Нэр</th>
            <th style="padding:0.6rem;">Утга</th>
            <th style="padding:0.6rem; text-align:center;">Үйлдэл</th>
        </tr>
    </thead>
    <tbody>
    {% for x in items %}
        <tr style="border-bottom:1px solid #eee;">
            <td style="padding:0.6rem;">{{ forloop.counter }}</td>
            <td style="padding:0.6rem;">{{ x.name }}</td>
            <td style="padding:0.6rem;">{{ x.value }}</td>
            <td style="padding:0.6rem; text-align:center;">

                <button class="btn-edit"
                        data-id="{{ x.id }}"
                        data-name="{{ x.name }}"
                        data-value="{{ x.value }}"
                        type="button">Засах</button>

                <form method="POST" style="display:inline;">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="delete">
                    <input type="hidden" name="id" value="{{ x.id }}">
                    <button type="submit" onclick="return confirm('Устгах уу?')">Устгах</button>
                </form>

            </td>
        </tr>
    {% empty %}
        <tr><td colspan="4" style="text-align:center; padding:1rem;">Хоосон байна.</td></tr>
    {% endfor %}
    </tbody>
</table>


<!-- EDIT MODAL -->
<div id="editModal" style="display:none; position:fixed; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.45);">
  <div style="background:white; width:400px; margin:6% auto; padding:1.2rem; border-radius:8px;">
    <h3>Төрөл засах</h3>

    <form method="POST">
      {% csrf_token %}
      <input type="hidden" name="action" value="edit">
      <input type="hidden" id="edit-id" name="id">

      <label>Нэр</label>
      <input id="edit-name" name="name" style="width:100%; padding:0.5rem; margin-bottom:0.6rem;">

      <label>Утга</label>
      <input id="edit-value" name="value" style="width:100%; padding:0.5rem; margin-bottom:1rem;">

      <div style="text-align:right;">
        <button type="button" id="editCancel">Болих</button>
        <button type="submit">Хадгалах</button>
      </div>
    </form>
  </div>
</div>


<script>
document.querySelectorAll(".btn-edit").forEach(btn => {
    btn.onclick = () => {
        document.getElementById("edit-id").value = btn.dataset.id;
        document.getElementById("edit-name").value = btn.dataset.name;
        document.getElementById("edit-value").value = btn.dataset.value;
        document.getElementById("editModal").style.display = "block";
    };
});
document.getElementById("editCancel").onclick = () =>
    document.getElementById("editModal").style.display = "none";
</script>

{% endblock %}
