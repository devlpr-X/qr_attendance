{% extends "base.html" %}

{% block title %}–ò—Ä—Ü –≥–∞—Ä–∞–∞—Ä —Ç—ç–º–¥—ç–≥–ª—ç—Ö{% endblock %}

{% block content %}
<div class="container" style="max-width:1100px; padding:1.5rem;">
  <h2 style="margin-bottom:1rem;">–ò—Ä—Ü –≥–∞—Ä–∞–∞—Ä —Ç—ç–º–¥—ç–≥–ª—ç—Ö</h2>

  <div style="display:flex; gap:1rem; align-items:center; margin-bottom:1rem;">
    <div style="background:#ffffff; padding:0.8rem 1rem; border-radius:8px; box-shadow:0 1px 4px rgba(0,0,0,0.05); flex:1;">
      <p style="margin:0; color:#0b2e78; font-weight:600;">Session ID: <span style="font-weight:700; color:#0b2e78;">{{ session_id }}</span></p>
      <p style="margin:0.35rem 0 0 0; color:#555; font-size:0.95rem;">–î–æ–æ—Ä—Ö —Ö“Ø—Å–Ω—ç–≥—Ç—ç–¥ –æ—é—É—Ç–∞–Ω –±“Ø—Ä–∏–π–Ω —Å—Ç–∞—Ç—É—Å—ã–≥ —Å–æ–Ω–≥–æ–æ–¥ <strong>–•–∞–¥–≥–∞–ª–∞—Ö</strong> —Ç–æ–≤—á –¥–∞—Ä–Ω–∞ —É—É.</p>
    </div>
    <div style="min-width:220px;">
      <a href="{% url 'session_view' session_id %}" class="btn" style="background:transparent; border:1px solid rgba(11,46,120,0.12); color:#0b2e78; padding:0.5rem 0.9rem; border-radius:6px; text-decoration:none;">
        ‚Üê Session —Ä“Ø“Ø –±—É—Ü–∞—Ö
      </a>
    </div>
  </div>

  {% if error %}
    <div class="flash-error" style="padding:0.8rem 1rem; margin-bottom:1rem; border-radius:6px;">
      {{ error }}
    </div>
  {% endif %}

  <form method="POST" novalidate>
    {% csrf_token %}

    {% if students %}
      <div style="overflow:auto; background:white; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.05);">
        <table style="width:100%; border-collapse:collapse; min-width:900px;">
          <thead>
            <tr style="background:#1d5ede; color:white; text-align:left;">
              <th style="padding:0.9rem 1rem; width:6%;">‚Ññ</th>
              <th style="padding:0.9rem 1rem; width:18%;">–ö–æ–¥</th>
              <th style="padding:0.9rem 1rem; width:46%;">–ù—ç—Ä</th>
              <th style="padding:0.9rem 1rem; width:30%;">–°—Ç–∞—Ç—É—Å</th>
            </tr>
          </thead>
          <tbody>
            {% for student in students %}
              <tr style="border-bottom:1px solid #eef2f7;">
                <td style="padding:0.8rem 1rem; vertical-align:middle;">{{ forloop.counter }}</td>
                <td style="padding:0.8rem 1rem; vertical-align:middle;">
                  <div style="font-weight:700; color:#0b2e78;">{{ student.student_code }}</div>
                </td>
                <td style="padding:0.8rem 1rem; vertical-align:middle;">
                  <div style="color:#222;">{{ student.full_name }}</div>
                </td>
                <td style="padding:0.6rem 1rem; vertical-align:middle;">
                  <select name="status_{{ student.id }}" required style="width:100%; padding:0.55rem; border-radius:6px; border:1px solid #d1d5db; font-size:0.95rem;">
                    <option value="">-- –°–æ–Ω–≥–æ–Ω–æ —É—É --</option>
                    {% for status in statuses %}
                      <option value="{{ status.value }}" {% if student.status == status.value %}selected{% endif %}>{{ status.name }}</option>
                    {% endfor %}
                  </select>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div style="background:white; border-radius:8px; padding:2rem; text-align:center; color:#6b7280; box-shadow:0 2px 8px rgba(0,0,0,0.03);">
        üì≠ –≠–Ω—ç —Ö–∏—á—ç—ç–ª–¥ –±“Ø—Ä—Ç–≥—ç–ª—Ç—ç–π –æ—é—É—Ç–∞–Ω –±–∞–π—Ö–≥“Ø–π –±–∞–π–Ω–∞.
      </div>
    {% endif %}

    <div style="display:flex; gap:1rem; margin-top:1.25rem; justify-content:flex-end;">
      <button type="submit" class="btn" style="background:#1d5ede; color:white; padding:0.7rem 1.1rem; border-radius:8px; border:none; font-weight:600;">
        ‚úì –•–∞–¥–≥–∞–ª–∞—Ö
      </button>
      <a href="{% url 'session_view' session_id %}" class="btn" style="background:#f3f4f6; color:#111827; padding:0.65rem 1.0rem; border-radius:8px; text-decoration:none; display:inline-flex; align-items:center;">
        –ë–æ–ª–∏—Ö
      </a>
    </div>
  </form>
</div>

<script>
  // JS: —Å–æ–Ω–≥–æ–≥–¥—Å–æ–Ω —Å—Ç–∞—Ç—É—Å—Ç–∞–π –º”©—Ä–∏–π–Ω ”©–Ω–≥”© ”©”©—Ä—á–ª”©—Ö
  (function(){
    const selects = document.querySelectorAll('select[name^="status_"]');
    selects.forEach(s => {
      function applyStyle() {
        const tr = s.closest('tr');
        const v = s.value;
        tr.style.background = ''; tr.style.color = ''; // reset
        if(v === 'present') {
          tr.style.background = 'rgba(34,197,94,0.06)'; // light green
        } else if(v === 'absent') {
          tr.style.background = 'rgba(239,68,68,0.06)'; // light red
        } else if(v === 'sick') {
          tr.style.background = 'rgba(249,115,22,0.06)'; // light orange
        } else {
          tr.style.background = '';
        }
      }
      s.addEventListener('change', applyStyle);
      // initialize
      if(s.value) applyStyle();
    });
  })();
</script>
{% endblock %}
