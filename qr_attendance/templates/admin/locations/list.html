{% extends "base.html" %}
{% block title %}–°—É—Ä–≥—É—É–ª–∏—É–¥{% endblock %}
{% block content %}

<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
  <h2 style="margin:0; color:#0b2e78;">–°—É—Ä–≥—É—É–ª—å</h2>
  <a href="{% url 'location_add' %}"><button id="btnAdd" class="btn-primary">+ –ù—ç–º—ç—Ö</button></a>
</div>

<link rel="stylesheet" href="/static/css/table_data.css">

<table class="data-table">
  <thead>
    <tr>
      <th>‚Ññ</th>
      <th>–ù—ç—Ä</th>
      <th>”®—Ä–≥”©—Ä”©–≥</th>
      <th>–£—Ä—Ç—Ä–∞–≥</th>
      <th>–ó–∞–π (–º)</th>
      <th style="text-align:center;">“Æ–π–ª–¥—ç–ª</th>
    </tr>
  </thead>

  <tbody>
    {% for l in locations %}
    <tr>
      <td>{{ forloop.counter }}</td>
      <td>{{ l.name }}</td>
      <td>{{ l.lat }}</td>
      <td>{{ l.lon }}</td>
      <td><span class="badge">{{ l.radius_m }}</span></td>

      <td style="text-align:center;">
        <button class="action-dots" onclick="openLocationMenu(event, '{{ l.id }}')">‚ãÆ</button>

      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="6" style="text-align:center; padding:1.5rem; color:#777;">
        –°—É—Ä–≥—É—É–ª—å –æ–ª–¥—Å–æ–Ω–≥“Ø–π
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Action Menu (3 —Ü—ç–≥) -->
<div id="locationMenu" class="action-menu">
  <a class="action-item" id="btnView">üëÅ –•–∞—Ä–∞—Ö</a>
  <a class="action-item" id="btnEdit">‚úèÔ∏è –ó–∞—Å–∞—Ö</a>
  <a class="action-item action-delete" id="btnDelete">üóëÔ∏è –£—Å—Ç–≥–∞—Ö</a>
</div>
<script>
  let selectedLocationId = null;
  
  function openLocationMenu(event, id) {
    selectedLocationId = id;
  
    const menu = document.getElementById("locationMenu");
    const rect = event.target.getBoundingClientRect();
  
    menu.style.display = "block";
    menu.style.top = rect.bottom + 6 + "px";
    menu.style.left = rect.left - 120 + "px";
  }
  
  // –≥–∞–¥—É—É—Ä –¥–∞—Ä–≤–∞–ª –∞–ª–≥–∞ –±–æ–ª–Ω–æ
  document.addEventListener("click", function (e) {
    const menu = document.getElementById("locationMenu");
    if (!e.target.closest(".action-dots") && !e.target.closest(".action-menu")) {
      menu.style.display = "none";
    }
  });
  
  // --- URL reverse –∞—à–∏–≥–ª–∞–Ω navigation —Ö–∏–π—Ö ---
  document.getElementById("btnView").onclick = () => {
    window.location.href = "/admin/school/" + selectedLocationId + "/";
  };
  
  document.getElementById("btnEdit").onclick = () => {
    window.location.href = "/admin/school/" + selectedLocationId + "/edit/";
  };
  
  document.getElementById("btnDelete").onclick = () => {
    if (confirm("–£—Å—Ç–≥–∞—Ö —É—É?")) {
      window.location.href = "/admin/school/" + selectedLocationId + "/delete/";
    }
  };
  </script>
  
{% endblock %}
